<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>单词配对游戏</title>
    <style>
        body {
            font-family: "微软雅黑", sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #f0f0f0;
            padding: 20px;
        }
        .game-container {
            width: 800px;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .word-box {
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid #333;
            border-radius: 5px;
        }
        .word-list {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            width: 100%;
            margin-bottom: 20px;
        }
        .word-item {
            padding: 10px 20px;
            background-color: #e9f5ff;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 16px;
        }
        .word-item.correct {
            background-color: #d4edda;
            color: #28a745;
            font-weight: bold;
        }
        .word-item.wrong {
            animation: flash 0.5s linear;
        }
        @keyframes flash {
            0%, 100% { background-color: #ffcccc; color: #dc3545; }
            50% { background-color: transparent; color: inherit; }
        }
        .button-group {
            margin-bottom: 20px;
        }
        button {
            padding: 10px 20px;
            margin: 0 10px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        #score-board {
            font-size: 18px;
            color: #6c757d;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>单词配对游戏</h1>
        
        <!-- 功能按钮 -->
        <div class="button-group">
            <input type="file" id="excelImport" accept=".xlsx, .xls" style="display: none;">
            <button onclick="document.getElementById('excelImport').click()">导入Excel单词表</button>
            <button onclick="showScore()">查看得分</button>
        </div>
        
        <!-- 文字框 -->
        <div class="word-box" id="chineseWord"></div>
        
        <!-- 单词列表 -->
        <div class="word-list" id="wordList"></div>
        
        <!-- 计分板 -->
        <div id="score-board">当前正确数：<span id="correctCount">0</span></div>
    </div>

    <!-- 引入SheetJS库用于解析Excel文件 -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

    <script>
        let wordData = []; // 存储单词数据
        let currentWord = null; // 当前显示的汉字
        let correctCount = 0; // 正确次数
        const MAX_OPTIONS = 9; // 最大显示选项数量

        // 解析Excel文件
        function parseExcel(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });
                        const sheetName = workbook.SheetNames[0]; // 使用第一个工作表
                        const worksheet = workbook.Sheets[sheetName];
                        
                        // 转换为JSON格式
                        const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                        
                        // 过滤空行并转换为对象数组
                        const words = jsonData
                            .filter(row => row.length >= 2 && row[0] && row[1])
                            .map(row => ({ chinese: row[0], english: row[1] }));
                            
                        resolve(words);
                    } catch (error) {
                        console.error("解析Excel失败:", error);
                        reject(error);
                    }
                };
                reader.onerror = (error) => reject(error);
                reader.readAsArrayBuffer(file);
            });
        }

        // 导入文件处理
        async function handleFileUpload(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            try {
                // 显示加载状态
                document.getElementById('chineseWord').textContent = "加载中...";
                
                // 解析Excel文件
                wordData = await parseExcel(file);
                
                if (wordData.length === 0) {
                    alert("Excel文件中未找到有效单词数据！");
                    document.getElementById('chineseWord').textContent = "请导入有效的单词表";
                    return;
                }
                
                // 显示导入成功信息
                document.getElementById('chineseWord').textContent = `已导入 ${wordData.length} 个单词`;
                
                // 延迟开始游戏
                setTimeout(startGame, 1000);
            } catch (error) {
                console.error("导入失败:", error);
                alert("导入失败，请检查文件格式是否正确。");
                document.getElementById('chineseWord').textContent = "导入失败";
            }
        }

        // 开始游戏
        function startGame() {
            correctCount = 0;
            document.getElementById('correctCount').textContent = 0;
            showNextWord();
        }

        // 渲染单词列表
        function renderWordList() {
            const listDiv = document.getElementById('wordList');
            listDiv.innerHTML = '';
            
            if (!currentWord || wordData.length === 0) return;
            
            // 确保选项包含当前正确单词
            const allWords = [...wordData.map(item => item.english)];
            
            // 如果单词总数不足MAX_OPTIONS，添加一些干扰项
            let distractors = ['apple', 'banana', 'cat', 'dog', 'book', 'pen', 'chair', 'table', 'window'];
            distractors = distractors.filter(word => !allWords.includes(word));
            
            // 合并正确答案和其他单词
            let options = [currentWord.english];
            
            // 从所有单词中随机选择其他选项
            const otherWords = allWords.filter(word => word !== currentWord.english);
            const shuffledOtherWords = otherWords.sort(() => Math.random() - 0.5);
            
            // 添加其他单词选项
            options = options.concat(shuffledOtherWords.slice(0, MAX_OPTIONS - 1));
            
            // 如果选项不足MAX_OPTIONS，添加干扰项
            if (options.length < MAX_OPTIONS) {
                const neededDistractors = MAX_OPTIONS - options.length;
                options = options.concat(distractors.slice(0, neededDistractors));
            }
            
            // 打乱顺序
            options.sort(() => Math.random() - 0.5);
            
            // 创建单词项
            options.forEach(word => {
                const div = document.createElement('div');
                div.className = 'word-item';
                div.textContent = word;
                div.onclick = () => checkAnswer(word);
                listDiv.appendChild(div);
            });
        }

        // 显示下一个汉字
        function showNextWord() {
            if (wordData.length === 0) {
                document.getElementById('chineseWord').textContent = "无单词数据";
                return;
            }
            
            const randomIndex = Math.floor(Math.random() * wordData.length);
            currentWord = wordData[randomIndex];
            document.getElementById('chineseWord').textContent = currentWord.chinese;
            
            // 渲染单词列表
            renderWordList();
        }

        // 检查答案
        function checkAnswer(clickedWord) {
            const wordItems = document.getElementsByClassName('word-item');
            Array.from(wordItems).forEach(item => item.classList.remove('correct', 'wrong'));
            
            if (clickedWord === currentWord.english) {
                correctCount++;
                document.getElementById('correctCount').textContent = correctCount;
                event.target.classList.add('correct');
                
                // 延迟显示下一个单词
                setTimeout(() => {
                    showNextWord();
                }, 500);
            } else {
                event.target.classList.add('wrong');
                
                // 错误闪烁效果后恢复
                setTimeout(() => {
                    event.target.classList.remove('wrong');
                }, 1000);
            }
        }

        // 显示计分板
        function showScore() {
            alert(`本次答对单词数：${correctCount}`);
        }

        // 绑定文件导入事件
        document.getElementById('excelImport').addEventListener('change', handleFileUpload);
    </script>
</body>
</html>